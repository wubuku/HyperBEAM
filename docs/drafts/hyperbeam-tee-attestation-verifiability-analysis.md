# HyperBEAM TEE Attestation: å¯éªŒè¯æ€§æ·±åº¦è§£æ

## æ¦‚è¿°

æœ¬æ–‡æ¡£åŸºäºå¯¹ HyperBEAM ä»£ç åº“çš„æ·±å…¥åˆ†æï¼Œç³»ç»Ÿæ€§åœ°é˜è¿°äº† TEEï¼ˆTrusted Execution Environmentï¼‰åœ¨ AO-Core ä¸­çš„å®ç°æœºåˆ¶ï¼Œç‰¹åˆ«æ˜¯é’ˆå¯¹ä»¥ä¸‹æ ¸å¿ƒé—®é¢˜ï¼š

1. å¦‚ä½•åšåˆ° Deterministic å’Œ Non-Deterministic ç¨‹åºéƒ½å¯ä»¥"verifiable"ï¼Ÿ
2. TEE å¦‚ä½•å®ç°"å¯éªŒè¯"ï¼Ÿï¼ˆé¢å‘ TEE å°ç™½çš„è§£é‡Šï¼‰

## æ ¸å¿ƒé—®é¢˜è§£ç­”

### 1. Deterministic ä¸ Non-Deterministic ç¨‹åºçš„å¯éªŒè¯æ€§

**æ ¸å¿ƒæ´å¯Ÿ**ï¼šTEE å¹¶ä¸ä¿è¯ç¨‹åºç»“æœçš„æ­£ç¡®æ€§ï¼Œå®ƒä¿è¯çš„æ˜¯æ‰§è¡Œç¯å¢ƒçš„å®Œæ•´æ€§å’Œå¯éªŒè¯æ€§ã€‚

#### Deterministic ç¨‹åºï¼ˆWASM, Luaï¼‰
- âœ… **ä»£ç å®Œæ•´æ€§éªŒè¯**ï¼šTEE ç¡®ä¿è¿è¡Œçš„ä»£ç ä¸é¢„æœŸçš„å®Œå…¨ä¸€è‡´
- âœ… **æ‰§è¡Œç¯å¢ƒéš”ç¦»**ï¼šä»£ç åœ¨ç¡¬ä»¶éš”ç¦»çš„ç¯å¢ƒä¸­è¿è¡Œ
- âœ… **ç»“æœç¡®å®šæ€§éªŒè¯**ï¼šå› ä¸ºè¾“å…¥ç¡®å®šï¼Œè¾“å‡ºä¹Ÿç¡®å®šï¼Œå¯ä»¥é€šè¿‡ replay éªŒè¯

#### Non-Deterministic ç¨‹åºï¼ˆLLMs, å¤–éƒ¨APIï¼‰
- âœ… **ä»£ç å®Œæ•´æ€§éªŒè¯**ï¼šä»ç„¶ç¡®ä¿è¿è¡Œçš„ä»£ç æœªè¢«ç¯¡æ”¹
- âœ… **æ‰§è¡Œç¯å¢ƒéš”ç¦»**ï¼šä»ç„¶åœ¨ç¡¬ä»¶éš”ç¦»ç¯å¢ƒä¸­è¿è¡Œ
- âš ï¸ **ç»“æœæ­£ç¡®æ€§**ï¼šTEE **æ— æ³•éªŒè¯ç»“æœçš„æ­£ç¡®æ€§**ï¼Œå› ä¸ºç»“æœæœ¬èº«å°±æ˜¯ä¸ç¡®å®šçš„

**å…³é”®ç†è§£**ï¼šæ–‡æ¡£ä¸­çš„ "Both are first-class in HyperBEAM. The compute step is always verifiable" æ„å‘³ç€**è®¡ç®—è¿‡ç¨‹æœ¬èº«æ˜¯å¯éªŒè¯çš„**ï¼Œä½†ä¸æ„å‘³ç€ç»“æœçš„æ­£ç¡®æ€§ã€‚

## TEE å·¥ä½œåŸç†è¯¦è§£

### ğŸ—ï¸ TEE çš„ç¡¬ä»¶ä¿é™©ç®±æ¨¡å‹

æƒ³è±¡ TEE æ˜¯ä¸€ä¸ª**å¸¦é”çš„ä¿é™©ç®±**ï¼š
- **ç¡¬ä»¶ä¿é™©ç®±**ï¼šç”± CPU èŠ¯ç‰‡ä¸­çš„ä¸“ç”¨å®‰å…¨åŒºåŸŸæ„æˆ
- **å”¯ä¸€é’¥åŒ™**ï¼šåªæœ‰è¿™ä¸ªä¿é™©ç®±æ‰èƒ½æ‰“å¼€ï¼ˆç¡¬ä»¶ç»‘å®šï¼‰
- **è¿è¡Œç¨‹åº**ï¼šä½ çš„ä»£ç åœ¨è¿™ä¸ªä¿é™©ç®±é‡Œæ‰§è¡Œ
- **è¯æ˜ä¿¡**ï¼šæ‰§è¡Œå®Œæ¯•åï¼Œä¿é™©ç®±ä¼šç»™ä½ ä¸€å°**ç»è¿‡å…¬è¯çš„è¯æ˜ä¿¡**

### ğŸ” AMD SEV-SNP å®ç°

HyperBEAM ä½¿ç”¨ AMD SEV-SNP ä½œä¸º TEE å®ç°ï¼š

```rust
// native/dev_snp_nif/src/attestation.rs
let report: AttestationReport = firmware.get_report(None, Some(unique_data_array), Some(vmpl))?
```

#### TEE ç”Ÿæˆè¯æ˜çš„è¿‡ç¨‹
1. **ä»£ç æµ‹é‡**ï¼ˆMeasurementï¼‰ï¼šè®¡ç®—è¿è¡Œä»£ç çš„å“ˆå¸Œå€¼
2. **ç¯å¢ƒè®°å½•**ï¼šè®°å½•ç¡¬ä»¶çŠ¶æ€ã€å›ºä»¶ç‰ˆæœ¬ç­‰
3. **æ•°å­—ç­¾å**ï¼šç”¨ç¡¬ä»¶ç§é’¥ç­¾åæ•´ä¸ªè¯æ˜æŠ¥å‘Š

## è¯ä¹¦é“¾éªŒè¯ä½“ç³»

### ğŸ›ï¸ å¤šå±‚è¯ä¹¦é“¾æ¶æ„

**ä¸ä¾èµ–å•ä¸€å‚å•†å…¬é’¥ï¼Œè€Œæ˜¯å¤šå±‚è¯ä¹¦é“¾éªŒè¯**ï¼š

```
AMD Root Key (ARK) â† æ ¹è¯ä¹¦ï¼Œç”± AMD æ§åˆ¶
    â†“
AMD SEV Key (ASK) â† SEV å¹³å°è¯ä¹¦ï¼Œç”± ARK ç­¾å
    â†“
Versioned Chip Key (VCEK) â† èŠ¯ç‰‡ç‰¹å®šè¯ä¹¦ï¼Œç”± ASK ç­¾å
    â†“
Attestation Report â† TEE ç”Ÿæˆçš„è¯æ˜ï¼Œç”± VCEK ç­¾å âœ…
```

### ğŸŒ è¯ä¹¦è·å–æœºåˆ¶

```rust
// native/dev_snp_nif/src/helpers.rs
const KDS_CERT_SITE: &str = "https://kdsintf.amd.com";

// è·å– AMD è¯ä¹¦é“¾
pub fn request_cert_chain(sev_prod_name: &str) -> Result<ca::Chain, Box<dyn std::error::Error>>

// è·å–èŠ¯ç‰‡ç‰¹å®š VCEK
pub fn request_vcek(chip_id: [u8; 64], reported_tcb: TcbVersion) -> Result<Certificate, Box<dyn std::error::Error>>
```

## éªŒè¯æµç¨‹è¯¦è§£

### ğŸ” Erlang å±‚é¢çš„éªŒè¯é€»è¾‘

```erlang
% src/dev_snp.erl ä¸­çš„éªŒè¯æ­¥éª¤

% 1. éªŒè¯ measurementï¼ˆä»£ç å®Œæ•´æ€§ï¼‰
{Status, MeasurementIsValid} = dev_snp_nif:verify_measurement(ReportJSON, ExpectedBin)

% 2. éªŒè¯ç­¾åè¯ä¹¦é“¾
{ok, ReportIsValid} = dev_snp_nif:verify_signature(ReportJSON)

% 3. éªŒè¯è½¯ä»¶å¯ä¿¡åº¦
IsTrustedSoftware = execute_is_trusted(M1, Msg, NodeOpts)

% 4. éªŒè¯éšæœºæ•°åŒ¹é…
NonceMatches = report_data_matches(Address, NodeMsgID, Nonce)
```

### ğŸ›¡ï¸ Rust å±‚é¢çš„ç¡¬ä»¶éªŒè¯

```rust
// native/dev_snp_nif/src/verification.rs

// éªŒè¯è¯ä¹¦é“¾
let ca = request_cert_chain("Milan").unwrap();
let vcek = request_vcek(chip_id_array, tcb_version).unwrap();

// éªŒè¯ attestation report
let cert_chain = Chain { ca, vek: vcek };
if let Err(e) = (&cert_chain, &attestation_report).verify() {
    // éªŒè¯å¤±è´¥
}
```

## Deterministic vs Non-Deterministic çš„åŒºåˆ«

| æ–¹é¢ | Deterministic | Non-Deterministic |
|------|---------------|-------------------|
| **TEE ä¿è¯** | ä»£ç  + ç»“æœå¯éªŒè¯ | ä»…ä»£ç å¯éªŒè¯ |
| **æ­£ç¡®æ€§è¯æ˜** | âœ… å®Œå…¨å¯è¯æ˜ | âš ï¸ æ— æ³•è¯æ˜ç»“æœæ­£ç¡®æ€§ |
| **åº”ç”¨åœºæ™¯** | æ™ºèƒ½åˆçº¦ã€ç¡®å®šæ€§è®¡ç®— | AI æ¨ç†ã€éšæœºæ•°ç”Ÿæˆ |
| **éªŒè¯æ–¹å¼** | Replay éªŒè¯ç»“æœ | ä»…éªŒè¯æ‰§è¡Œç¯å¢ƒ |

## å…³é”®ä»£ç ä½ç½®

### Erlang å®ç°
- `src/dev_snp.erl` - SNP è®¾å¤‡çš„ä¸»è¦é€»è¾‘
- `src/dev_snp_nif.erl` - NIF æ¥å£å®šä¹‰

### Rust å®ç°
- `native/dev_snp_nif/src/attestation.rs` - Attestation ç”Ÿæˆ
- `native/dev_snp_nif/src/verification.rs` - éªŒè¯é€»è¾‘
- `native/dev_snp_nif/src/helpers.rs` - è¯ä¹¦é“¾å¤„ç†

### æµ‹è¯•æ•°æ®
- `test/snp_attestation` - æµ‹è¯•ç”¨çš„ attestation æ•°æ®
- `test/snp-commitment` - æ‰¿è¯ºéªŒè¯æµ‹è¯•

## TEE çš„å±€é™æ€§ä¸æƒè¡¡

### âš ï¸ æŠ€æœ¯å±€é™æ€§

1. **æ€§èƒ½å¼€é”€**ï¼šTEE æ‰§è¡Œæ¯”æ™®é€šç¯å¢ƒæ…¢
2. **å†…å­˜é™åˆ¶**ï¼šTEE ç¯å¢ƒå†…å­˜æœ‰é™
3. **æ— æ³•éªŒè¯è¯­ä¹‰æ­£ç¡®æ€§**ï¼šåªèƒ½éªŒè¯"ä»£ç æŒ‰é¢„æœŸè¿è¡Œ"ï¼Œä¸èƒ½éªŒè¯"ç»“æœåœ¨ä¸šåŠ¡ä¸Šæ˜¯æ­£ç¡®çš„"

### ğŸ”„ ä¸ AO ç”Ÿæ€çš„é›†æˆ

HyperBEAM é€šè¿‡ Greenzoneï¼ˆå»ä¸­å¿ƒåŒ– TEE ç½‘ç»œï¼‰å®ç°äº†ï¼š
- **ç¡¬ä»¶çº§åˆ«çš„è®¡ç®—å®Œæ•´æ€§ä¿è¯**
- **å»ä¸­å¿ƒåŒ–çš„è¯æ˜ç½‘ç»œ**
- **éšç§è®¡ç®—çš„åŸºç¡€è®¾æ–½**

## ç»“è®º

TEE åœ¨ HyperBEAM ä¸­çš„å¯éªŒè¯æ€§å®ç°åŸºäº**ç¡¬ä»¶çº§åˆ«çš„ä¿¡ä»»æ ¹**ï¼Œé€šè¿‡å¤šå±‚è¯ä¹¦é“¾éªŒè¯ç¡®ä¿ï¼š

1. **æ‰§è¡Œç¯å¢ƒéš”ç¦»**ï¼šä»£ç åœ¨ç¡¬ä»¶ä¿æŠ¤çš„ç¯å¢ƒä¸­è¿è¡Œ
2. **ä»£ç å®Œæ•´æ€§**ï¼šè¿è¡Œçš„ä»£ç æœªè¢«ç¯¡æ”¹
3. **è¯æ˜å¯éªŒè¯æ€§**ï¼šä»»ä½•äººéƒ½èƒ½ç‹¬ç«‹éªŒè¯è¯æ˜çš„çœŸå®æ€§

å…³é”®æ´å¯Ÿï¼š**TEE ä¿è¯çš„æ˜¯"è¿™ä¸ªè®¡ç®—ç¡®å®æŒ‰é¢„æœŸçš„æ–¹å¼æ‰§è¡Œäº†"ï¼Œè€Œä¸æ˜¯"è¿™ä¸ªç»“æœåœ¨ä¸šåŠ¡é€»è¾‘ä¸Šæ˜¯æ­£ç¡®çš„"**ã€‚å¯¹äºéç¡®å®šæ€§ç¨‹åºï¼ŒTEE æä¾›äº†ä¿¡ä»»çš„åŸºç¡€ï¼Œä½†ä¸šåŠ¡å±‚é¢çš„æ­£ç¡®æ€§éªŒè¯ä»ç„¶éœ€è¦é¢å¤–çš„æœºåˆ¶ã€‚

---

*æœ¬æ–‡æ¡£åŸºäº HyperBEAM ä»£ç åº“åˆ†ææ•´ç†ï¼Œè®°å½•äº† TEE attestation å’Œå¯éªŒè¯æ€§æœºåˆ¶çš„æ·±åº¦ç†è§£ã€‚å¦‚æœ‰æ›´æ–°ï¼Œè¯·åŠæ—¶ä¿®æ­£ã€‚*
